@baseUrl = http://localhost:8000/api/v1

###

@sign_in_auth = {{sign_in.response.body.auth}}

# @name sign_in
POST {{baseUrl}}/auth/sign-in
Content-Type: application/json

{
  "email": "alimam@example.com",
  "password": "alimam@example.com"
}

###

@create_bucket_id = {{create_bucket.response.body.id}}

# @name create_bucket
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Test Bucket for Secret Token"
}

###

@create_secret_id = {{create_secret.response.body.id}}

# @name create_secret
POST {{baseUrl}}/secrets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "secret": "This is a secret message for testing",
  "expiresAt": "2025-12-31T23:59:59.000Z"
}

###

@create_secret_with_validation_uri_id = {{create_secret_with_validation_uri.response.body.id}}

# @name create_secret_with_validation_uri
POST {{baseUrl}}/secrets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "secret": "Secret with validation URI for testing",
  "expiresAt": "2025-12-31T23:59:59.000Z",
  "validationUri": "https://example.com/validate"
}

###

@create_secret_without_expiry_id = {{create_secret_without_expiry.response.body.id}}

# @name create_secret_without_expiry
POST {{baseUrl}}/secrets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "secret": "Secret without expiry for token testing"
}

###

# @name get_secrets
GET {{baseUrl}}/secrets/
Cookie: auth={{sign_in_auth}}

###

# @name get_secret_by_id
GET {{baseUrl}}/secrets/{{create_secret_id}}
Cookie: auth={{sign_in_auth}}

###

# @name get_secret_with_validation_uri
GET {{baseUrl}}/secrets/{{create_secret_with_validation_uri_id}}
Cookie: auth={{sign_in_auth}}

###

@read_token = {{issue_authorization.response.body.readToken}}

# @name issue_authorization
POST {{baseUrl}}/secrets/issue/read-token
Content-Type: application/json
X-Secret: This is a secret message for testing

{
  "secret": "This is a secret message for testing",
  "bucketId": "{{create_bucket_id}}",
  "keys": ["file1.txt", "file2.pdf", "images/photo.jpg"]
}

###

@read_token_no_expiry = {{issue_authorization_no_expiry.response.body.readToken}}

# @name issue_authorization_no_expiry
POST {{baseUrl}}/secrets/issue/read-token
Content-Type: application/json
X-Secret: Secret without expiry for token testing

{
  "secret": "Secret without expiry for token testing",
  "bucketId": "{{create_bucket_id}}",
  "keys": ["document.txt"]
}

###

# @name verify_read_token
POST {{baseUrl}}/secrets/verify-read-token
Content-Type: application/json

{
  "readToken": "{{read_token}}"
}

###

# @name verify_read_token_no_expiry
POST {{baseUrl}}/secrets/verify-read-token
Content-Type: application/json

{
  "readToken": "{{read_token_no_expiry}}"
}

###

# @name issue_authorization_invalid_secret
POST {{baseUrl}}/secrets/issue/read-token
Content-Type: application/json
X-Secret: This secret does not exist

{
  "secret": "This secret does not exist",
  "bucketId": "{{create_bucket_id}}",
  "keys": ["file1.txt"]
}

###

# @name issue_authorization_invalid_bucket
POST {{baseUrl}}/secrets/issue/read-token
Content-Type: application/json
X-Secret: This is a secret message for testing

{
  "secret": "This is a secret message for testing",
  "bucketId": "01HQWERTYUIOPASDFGHJKLZXCVB",
  "keys": ["file1.txt"]
}

###

# @name verify_invalid_read_token
POST {{baseUrl}}/secrets/verify-read-token
Content-Type: application/json

{
  "readToken": "invalid.jwt.token"
}

###

# @name delete_secret
DELETE {{baseUrl}}/secrets/{{create_secret_id}}
Cookie: auth={{sign_in_auth}}

###

# @name delete_secret_with_validation_uri
DELETE {{baseUrl}}/secrets/{{create_secret_with_validation_uri_id}}
Cookie: auth={{sign_in_auth}}

###

# @name delete_secret_without_expiry
DELETE {{baseUrl}}/secrets/{{create_secret_without_expiry_id}}
Cookie: auth={{sign_in_auth}}

###

# @name delete_expired_secrets
DELETE {{baseUrl}}/secrets/expired/cleanup
Cookie: auth={{sign_in_auth}}
