@baseUrl = http://localhost:8000/api/v1

###

@sign_in_auth = {{sign_in.response.body.auth}}

# @name sign_in
POST {{baseUrl}}/auth/sign-in
Content-Type: application/json

{
  "email": "alimam@example.com",
  "password": "alimam@example.com"
}

### ============ BUCKET EDGE CASES ============

# @name create_bucket_empty_name
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": ""
}

###

# @name create_bucket_no_name
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{}

###

# @name create_bucket_no_auth
POST {{baseUrl}}/buckets/
Content-Type: application/json

{
  "name": "Unauthorized Bucket"
}

###

@bucket_for_config_tests_id = {{create_bucket_for_config_tests.response.body.id}}

# @name create_bucket_for_config_tests
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Bucket for Config Tests"
}

###

# @name create_bucket_with_invalid_config
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Invalid Config Bucket",
  "config": {
    "allowedFileTypes": "invalid_format",
    "maxFileSize": "not_a_number"
  }
}

###

# @name create_bucket_with_negative_max_size
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Negative Max Size Bucket",
  "config": {
    "allowedFileTypes": [".txt"],
    "maxFileSize": -1024
  }
}

###

@bucket_with_strict_config_id = {{create_bucket_with_strict_config.response.body.id}}

# @name create_bucket_with_strict_config
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Strict Config Bucket",
  "config": {
    "allowedFileTypes": [".txt"],
    "maxFileSize": 1024
  }
}

###

# @name get_buckets_no_auth
GET {{baseUrl}}/buckets/

###

# @name get_bucket_nonexistent
GET {{baseUrl}}/buckets/01HQWERTYUIOPASDFGHJKLZXCVB
Cookie: auth={{sign_in_auth}}

###

# @name get_bucket_no_auth
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}

###

# @name update_bucket_empty_name
PUT {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": ""
}

###

# @name update_bucket_no_auth
PUT {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}
Content-Type: application/json

{
  "name": "Unauthorized Update"
}

###

# @name update_nonexistent_bucket
PUT {{baseUrl}}/buckets/01HQWERTYUIOPASDFGHJKLZXCVB
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Update Nonexistent Bucket"
}

###

# @name update_bucket_invalid_config
PUT {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Updated Config Test Bucket",
  "config": {
    "allowedFileTypes": 123,
    "maxFileSize": "invalid"
  }
}

###

# @name delete_bucket_no_auth
DELETE {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}

###

# @name delete_nonexistent_bucket
DELETE {{baseUrl}}/buckets/01HQWERTYUIOPASDFGHJKLZXCVB
Cookie: auth={{sign_in_auth}}

### ============ ASSET EDGE CASES ============

# @name create_asset_in_nonexistent_bucket
POST {{baseUrl}}/buckets/01HQWERTYUIOPASDFGHJKLZXCVB/assets/
Cookie: auth={{sign_in_auth}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="test.txt"
Content-Type: text/plain

Test content
--WebAppBoundary
Content-Disposition: form-data; name="keys"

test~file
--WebAppBoundary--

###

# @name create_asset_no_auth
POST {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="unauthorized.txt"
Content-Type: text/plain

This should fail
--WebAppBoundary--

###

# @name create_asset_no_file
POST {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/
Cookie: auth={{sign_in_auth}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="keys"

test~file
--WebAppBoundary--

###

@test_asset_id = {{create_test_asset.response.body.id}}

# @name create_test_asset
POST {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/
Cookie: auth={{sign_in_auth}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="edge-case-test.txt"
Content-Type: text/plain

This is an edge case test file
--WebAppBoundary
Content-Disposition: form-data; name="keys"

edge~case~test
--WebAppBoundary--

###

# @name create_asset_violate_strict_config_size
POST {{baseUrl}}/buckets/{{bucket_with_strict_config_id}}/assets/
Cookie: auth={{sign_in_auth}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="large-test.txt"
Content-Type: text/plain

This file content is designed to exceed the 1024 byte limit set in the bucket configuration. Let me add more content to make sure it goes over the limit. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.
--WebAppBoundary
Content-Disposition: form-data; name="keys"

large~file~test
--WebAppBoundary--

###

# @name create_asset_violate_strict_config_type
POST {{baseUrl}}/buckets/{{bucket_with_strict_config_id}}/assets/
Cookie: auth={{sign_in_auth}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="test.json"
Content-Type: application/json

{"test": "This should fail due to file type restriction"}
--WebAppBoundary
Content-Disposition: form-data; name="keys"

json~test~fail
--WebAppBoundary--

###

# @name get_assets_nonexistent_bucket
GET {{baseUrl}}/buckets/01HQWERTYUIOPASDFGHJKLZXCVB/assets/?cursor=1&limit=10
Cookie: auth={{sign_in_auth}}

###

# @name get_assets_no_auth
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/?cursor=1&limit=10

###

# @name get_assets_invalid_pagination
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/?cursor=-1&limit=0
Cookie: auth={{sign_in_auth}}

###

# @name get_assets_large_limit
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/?cursor=1&limit=1000
Cookie: auth={{sign_in_auth}}

###

# @name get_asset_nonexistent
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/01HQWERTYUIOPASDFGHJKLZXCVB
Cookie: auth={{sign_in_auth}}

###

# @name get_asset_no_auth
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/{{test_asset_id}}

###

# @name get_asset_wrong_bucket
GET {{baseUrl}}/buckets/01HQWERTYUIOPASDFGHJKLZXCVB/assets/{{test_asset_id}}
Cookie: auth={{sign_in_auth}}

###

# @name update_asset_nonexistent
PATCH {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/01HQWERTYUIOPASDFGHJKLZXCVB
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "nonexistent-update.txt"
}

###

# @name update_asset_no_auth
PATCH {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/{{test_asset_id}}
Content-Type: application/json

{
  "name": "unauthorized-update.txt"
}

###

# @name update_asset_empty_name
PATCH {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/{{test_asset_id}}
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": ""
}

###

# @name download_asset_nonexistent
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/01HQWERTYUIOPASDFGHJKLZXCVB/download
Cookie: auth={{sign_in_auth}}

###

# @name download_asset_no_auth
GET {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/{{test_asset_id}}/download

###

# @name delete_asset_nonexistent
DELETE {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/01HQWERTYUIOPASDFGHJKLZXCVB
Cookie: auth={{sign_in_auth}}

###

# @name delete_asset_no_auth
DELETE {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/{{test_asset_id}}

###

# @name delete_asset_valid
DELETE {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}/assets/{{test_asset_id}}
Cookie: auth={{sign_in_auth}}

###

# @name cleanup_bucket_for_config_tests
DELETE {{baseUrl}}/buckets/{{bucket_for_config_tests_id}}
Cookie: auth={{sign_in_auth}}

###

# @name cleanup_bucket_with_strict_config
DELETE {{baseUrl}}/buckets/{{bucket_with_strict_config_id}}
Cookie: auth={{sign_in_auth}}
