@baseUrl = http://localhost:8000/api/v1

###

@sign_in_auth = {{sign_in.response.body.auth}}

# @name sign_in
POST {{baseUrl}}/auth/sign-in
Content-Type: application/json

{
  "email": "alimam@example.com",
  "password": "alimam@example.com"
}

###

@bucket_id = {{create_bucket.response.body.id}}

# @name create_bucket
POST {{baseUrl}}/buckets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "name": "Direct Asset Access Test Bucket"
}

###

@secret_value = This is a test secret for direct asset access

@secret_id = {{create_secret.response.body.id}}

# @name create_secret
POST {{baseUrl}}/secrets/
Content-Type: application/json
Cookie: auth={{sign_in_auth}}

{
  "secret": "{{secret_value}}",
  "expiresAt": "2025-12-31T23:59:59.000Z"
}

###

@read_token = {{issue_read_token.response.body.readToken}}

# @name issue_read_token
POST {{baseUrl}}/secrets/issue/read-token
Content-Type: application/json
X-Secret: {{secret_value}}

{
  "secret": "{{secret_value}}",
  "bucketId": "{{bucket_id}}",
  "keys": ["test.txt", "document.pdf", "images/photo.jpg"]
}

###

# @name verify_read_token
POST {{baseUrl}}/secrets/verify-read-token
Content-Type: application/json

{
  "readToken": "{{read_token}}"
}

###

# @name verify_invalid_read_token
POST {{baseUrl}}/secrets/verify-read-token
Content-Type: application/json

{
  "readToken": "invalid.jwt.token.here"
}

###

@asset_id = {{create_direct_asset.response.body.id}}

# @name create_direct_asset
POST {{baseUrl}}/assets/{{bucket_id}}
X-Secret: {{secret_value}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="direct-test.txt"
Content-Type: text/plain

This is a test file created via direct asset API
--WebAppBoundary
Content-Disposition: form-data; name="bucketId"

{{bucket_id}}
--WebAppBoundary
Content-Disposition: form-data; name="keys"

test~document~direct
--WebAppBoundary--

###

# @name create_direct_asset_no_secret
POST {{baseUrl}}/assets/{{bucket_id}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="file"; filename="fail-test.txt"
Content-Type: text/plain

This should fail without secret
--WebAppBoundary
Content-Disposition: form-data; name="bucketId"

{{bucket_id}}
--WebAppBoundary--

###

# @name create_direct_asset_no_file
POST {{baseUrl}}/assets/{{bucket_id}}
X-Secret: {{secret_value}}
Content-Type: multipart/form-data; boundary=WebAppBoundary

--WebAppBoundary
Content-Disposition: form-data; name="bucketId"

{{bucket_id}}
--WebAppBoundary--

###

@signed_url = {{generate_signed_url.response.body.signedUrl}}

# @name generate_signed_url
POST {{baseUrl}}/assets/signed-url
X-Secret: {{secret_value}}
Content-Type: application/json

{
  "assetId": "{{asset_id}}",
  "expiresAt": "2025-12-31T23:59:59.000Z"
}

###

# @name generate_signed_url_no_secret
POST {{baseUrl}}/assets/signed-url
Content-Type: application/json

{
  "assetId": "{{asset_id}}",
  "expiresAt": "2025-12-31T23:59:59.000Z"
}

###

# @name generate_signed_url_invalid_asset
POST {{baseUrl}}/assets/signed-url
X-Secret: {{secret_value}}
Content-Type: application/json

{
  "assetId": "01HQWERTYUIOPASDFGHJKLZXCVB",
  "expiresAt": "2025-12-31T23:59:59.000Z"
}

###

# @name access_via_signed_url
GET {{baseUrl}}/assets/signed/{{signed_url}}

###

# @name access_via_invalid_signed_url
GET {{baseUrl}}/assets/signed/invalid-signed-url-token

###

# @name access_asset_via_read_token
GET {{baseUrl}}/assets/{{asset_id}}
Cookie: read-token={{read_token}}

###

# @name access_asset_no_read_token
GET {{baseUrl}}/assets/{{asset_id}}

###

# @name access_nonexistent_asset
GET {{baseUrl}}/assets/01HQWERTYUIOPASDFGHJKLZXCVB
Cookie: read-token={{read_token}}

###

# @name delete_direct_asset
DELETE {{baseUrl}}/assets/{{asset_id}}
X-Secret: {{secret_value}}
Content-Type: application/json

{
  "bucketId": "{{bucket_id}}"
}

###

# @name delete_direct_asset_no_secret
DELETE {{baseUrl}}/assets/{{asset_id}}
Content-Type: application/json

{
  "bucketId": "{{bucket_id}}"
}

###

# @name delete_nonexistent_asset
DELETE {{baseUrl}}/assets/01HQWERTYUIOPASDFGHJKLZXCVB
X-Secret: {{secret_value}}
Content-Type: application/json

{
  "bucketId": "{{bucket_id}}"
}

###

# @name cleanup_secret
DELETE {{baseUrl}}/secrets/{{secret_id}}
Cookie: auth={{sign_in_auth}}

###

# @name cleanup_bucket
DELETE {{baseUrl}}/buckets/{{bucket_id}}
Cookie: auth={{sign_in_auth}}
